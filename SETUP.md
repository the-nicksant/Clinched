# OctoDraft Setup Guide

This guide will walk you through setting up the OctoDraft development environment.

## ‚úÖ Prerequisites

- **Node.js 18+** installed
- **npm** package manager
- **Git** (already initialized)

## üöÄ Step-by-Step Setup

### 1. Install Dependencies

All dependencies are already installed. If you need to reinstall:

```bash
npm install
```

### 2. Set Up Convex Backend

**Important**: You need to run this in a **separate terminal** and keep it running.

```bash
npx convex dev
```

On first run, this will:
1. Prompt you to log in to Convex (or create an account)
2. Ask you to create a new project or select an existing one
3. Generate `.env.local` with these variables:
   - `CONVEX_DEPLOYMENT=dev:xxxxx`
   - `NEXT_PUBLIC_CONVEX_URL=https://xxxxx.convex.cloud`
4. Push the schema from `convex/schema.ts` to your database
5. Start watching for changes

**Keep this terminal running** - it's your backend server!

### 3. Set Up Clerk Authentication

1. **Go to [clerk.com](https://clerk.com)** and sign up/log in

2. **Create a new application**:
   - Click "Add application"
   - Choose "Next.js" as the framework
   - Enable social providers (Google, Discord, etc.) if desired

3. **Copy your API keys**:
   - From the Clerk dashboard, go to "API Keys"
   - Copy the publishable key (starts with `pk_test_`)
   - Copy the secret key (starts with `sk_test_`)

4. **Add to `.env.local`** (create this file if it doesn't exist):
   ```bash
   # Add these to the .env.local file (Convex already added its variables)
   NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_your_key_here
   CLERK_SECRET_KEY=sk_test_your_key_here
   NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
   NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
   NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/
   NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/
   ```

5. **Configure Clerk webhook** (for syncing users to Convex):
   - In Clerk dashboard, go to "Webhooks"
   - Add endpoint: `https://your-convex-url.convex.site/clerk` (you'll set this up later)
   - Subscribe to: `user.created` and `user.updated` events

### 4. Run the Development Server

In a **new terminal** (keep Convex running in the first one):

```bash
npm run dev
```

Your app should now be running at [http://localhost:3000](http://localhost:3000)

### 5. Verify Setup

Check that everything is working:

- [ ] Next.js dev server is running (http://localhost:3000)
- [ ] Convex dev server is running (separate terminal)
- [ ] `.env.local` exists with all required variables
- [ ] You can access the Clerk sign-in page

## üß™ Run Tests

Verify that the test setup works:

```bash
npm test
```

This should start Vitest in watch mode. Press `q` to quit.

## üìÇ Your `.env.local` Should Look Like This

```env
# Convex (auto-generated by `npx convex dev`)
CONVEX_DEPLOYMENT=dev:xxxxx
NEXT_PUBLIC_CONVEX_URL=https://xxxxx.convex.cloud

# Clerk (you add these manually)
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_xxxxx
CLERK_SECRET_KEY=sk_test_xxxxx
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/
```

## üéØ Next Steps

Now that setup is complete, you can:

1. **Start building with TDD**:
   - Create tests in `tests/domain/services/`
   - Implement business logic in `src/domain/services/`
   - Run `npm test` to watch tests

2. **Explore the codebase**:
   - See `src/domain/README.md` for domain layer documentation
   - Check `docs/CLEAN_ARCHITECTURE_PLAN.md` for architecture details
   - Review `docs/SCORING_RULES.md` for business logic specifications

3. **First feature to build**: Scoring Engine
   - Start with `tests/domain/services/ScoringEngine.test.ts`
   - Implement `src/domain/services/ScoringEngine.ts`
   - Follow examples from `docs/SCORING_RULES.md`

## üêõ Troubleshooting

### Convex: "Cannot find module 'convex/server'"

Run `npm install` again to ensure Convex is installed.

### Clerk: "Invalid publishable key"

Make sure you copied the **publishable key** (starts with `pk_test_`) and not the secret key.

### Tests: "Cannot find module '@/domain/...'"

Make sure you have the latest `tsconfig.json` and `vitest.config.ts` with path aliases configured.

### Port 3000 already in use

Stop any other Next.js apps running, or change the port:
```bash
npm run dev -- -p 3001
```

## üìñ Additional Resources

- [Next.js Documentation](https://nextjs.org/docs)
- [Convex Documentation](https://docs.convex.dev)
- [Clerk Documentation](https://clerk.com/docs)
- [Vitest Documentation](https://vitest.dev)

---

‚úÖ **Setup complete!** You're ready to start building OctoDraft with TDD.
